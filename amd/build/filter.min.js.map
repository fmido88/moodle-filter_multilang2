{"version":3,"file":"filter.min.js","sources":["../src/filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module filter\n *\n * @module     filter_multilang2/filter\n * @copyright  2025 Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport {eventTypes, notifyFilterContentRenderingComplete} from 'core_filters/events';\n\nlet elements = [];\nlet data = [];\nlet onRequest = false;\n/**\n * Process filtering.\n * @param {CustomEvent} event\n */\nasync function filter(event) {\n    if (onRequest) {\n        return;\n    }\n\n    onRequest = true;\n    let contextid = M.cfg.contextid;\n    let selector;\n    if (event && event.originalEvent && event.originalEvent.detail.nodes) {\n        selector = event.originalEvent.detail.nodes;\n    } else {\n        selector = ['body'];\n    }\n\n    $.each(selector, function(index, element) {\n        // Get the element and its siblings.\n        // Modal not including footer and header in the event.\n        $(element).parent().children()\n                  .find('*')\n                  // Exclude some tricky.\n                  .not('script, link, noscript, iframe, embed, input, head')\n                  .each(function() {\n\n            let current = $(this);\n            if (current.children().length == 0 && current.text().toLowerCase().includes('mlang')) {\n                elements.push(this);\n                data.push(current.text());\n            }\n        });\n    });\n\n    let requests = Ajax.call([\n        {\n            methodname: 'filter_multilang2',\n            args: {\n                contextid: contextid,\n                data: data,\n            }\n        }\n    ]);\n\n    let response = await requests[0];\n    elements.forEach((element, index) => {\n        $(element).text(response[index]);\n    });\n\n    // Trigger events of what elements changed.\n    notifyFilterContentRenderingComplete(elements);\n\n    elements = [];\n    data = [];\n    onRequest = false;\n}\n\nexport const init = function() {\n    // Wait for the page to fully loaded.\n    $(filter);\n\n    // Apply the filter again if content changed.\n    $(document).on(eventTypes.filterContentUpdated, filter);\n};"],"names":["elements","data","onRequest","filter","event","selector","contextid","M","cfg","originalEvent","detail","nodes","each","index","element","parent","children","find","not","current","this","length","text","toLowerCase","includes","push","requests","Ajax","call","methodname","args","response","forEach","document","on","eventTypes","filterContentUpdated"],"mappings":";;;;;;;kKA0BIA,SAAW,GACXC,KAAO,GACPC,WAAY,iBAKDC,OAAOC,UACdF,iBAIJA,WAAY,MAERG,SADAC,UAAYC,EAAEC,IAAIF,UAGlBD,SADAD,OAASA,MAAMK,eAAiBL,MAAMK,cAAcC,OAAOC,MAChDP,MAAMK,cAAcC,OAAOC,MAE3B,CAAC,wBAGdC,KAAKP,UAAU,SAASQ,MAAOC,6BAG3BA,SAASC,SAASC,WACTC,KAAK,KAELC,IAAI,sDACJN,MAAK,eAERO,SAAU,mBAAEC,MACiB,GAA7BD,QAAQH,WAAWK,QAAeF,QAAQG,OAAOC,cAAcC,SAAS,WACxExB,SAASyB,KAAKL,MACdnB,KAAKwB,KAAKN,QAAQG,mBAK1BI,SAAWC,cAAKC,KAAK,CACrB,CACIC,WAAY,oBACZC,KAAM,CACFxB,UAAWA,UACXL,KAAMA,SAKd8B,eAAiBL,SAAS,GAC9B1B,SAASgC,SAAQ,CAAClB,QAASD,6BACrBC,SAASQ,KAAKS,SAASlB,4DAIQb,UAErCA,SAAW,GACXC,KAAO,GACPC,WAAY,gBAGI,+BAEdC,4BAGA8B,UAAUC,GAAGC,mBAAWC,qBAAsBjC"}