define("filter_multilang2/filter",["exports","jquery","core/ajax","core_filters/events"],(function(_exports,_jquery,_ajax,_events){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Apply multilang filter from the client side using ajax request.
   *
   * @module     filter_multilang2/filter
   * @copyright  2025 Mohammad Farouk <phun.for.physics@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);let retryTimeout,elements=[],data=[],onRequest=!1,queue=[];function queueFilter(){let event=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;queue.push({event:event,done:!1}),runInterval()}function runInterval(){clearTimeout(retryTimeout),retryTimeout=setTimeout(processQueue,500)}function processQueue(){if(clearTimeout(retryTimeout),0==queue.length)return;if(onRequest)return void runInterval();let item;for(let i=0;i<queue.length;i++)if(item=queue[i],item.done)queue.splice(i,1);else{if(item.event)break;item=null}item&&(runInterval(),filter(item.event))}async function filter(){let event=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(onRequest)return void queueFilter(event);onRequest=!0;let selectors,contextid=M.cfg.contextid;if(selectors=event&&event.originalEvent&&event.originalEvent.detail.nodes?event.originalEvent.detail.nodes:["body"],_jquery.default.each(selectors,(function(index,element){let exclude="script, noscript, head, style";exclude+=", img, video, audio, canvas, svg, object, embed, iframe, link, source",exclude+=', input, textarea, [data-fieldtype="textarea"], [data-fieldtype="editor"]',exclude+=', [contenteditable="true"]',exclude+=", code, pre",exclude+=", .ignore-multilang",(0,_jquery.default)(element).parent().not(exclude).children().not(exclude).find("*").not(exclude).each((function(){let parent=(0,_jquery.default)(this);parent.parents(exclude).length>0||parent.contents().each((function(){if(3===this.nodeType)this.textContent.toLowerCase().includes("mlang")&&(elements.push(this),data.push(this.textContent));else if(1===this.nodeType){let current=(0,_jquery.default)(this);if(current.is(exclude))return;if(current.children().length>0)return;if(elements.includes(this))return;current.text().toLowerCase().includes("mlang")&&(elements.push(this),data.push(current.text()))}}))}))})),0==data.length)return elements=[],data=[],void(onRequest=!1);let requests=_ajax.default.call([{methodname:"filter_multilang2",args:{contextid:contextid,data:data}}],!0,!1),response=await requests[0];elements.forEach(((element,index)=>{3===element.nodeType?element.textContent=response[index]:(0,_jquery.default)(element).text(response[index])})),(0,_events.notifyFilterContentRenderingComplete)(elements),elements=[],data=[],onRequest=!1}_exports.init=function(){(0,_jquery.default)(filter),(0,_jquery.default)(document).on(_events.eventTypes.filterContentUpdated,filter)}}));

//# sourceMappingURL=filter.min.js.map